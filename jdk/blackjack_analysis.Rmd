---
title: "blkjck_stock_preanalysis"
author: "Jack Kincannon"
date: "12/3/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(patchwork)
library(TTR)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, message=FALSE}
dat1 <- read_csv("data/blkjckhands.csv")
```

```{r}
glimpse(dat1)
```

```{r}
# create new binary winloss variables 

# summary statistics for interesting values ply2cardsum/card1/card2/dealcard1/dealcard2/winloss/blkjack
summary(dat1$ply2cardsum)
summary(dat1$card1)
summary(dat1$card2)
summary(dat1$dealcard1)
summary(dat1$dealcard2)
summary(dat1$plwinamt)
summary(dat1$dlwinamt)
```


```{r}

# percent chance of win
windat <- dat1 %>%
  filter(plwinamt == 20) %>%
  summarise(win_count = n()) 

totl_dat <- dat1 %>%
  summarise(totl_count = n())

win_pct <- max(windat$win_count) / max(totl_dat$totl_count)
win_pct

# percent chance of push
pushdat <- dat1 %>%
  filter(plwinamt == 10) %>%
  summarise(push_count = n()) 

totl_dat <- dat1 %>%
  summarise(totl_count = n())

push_pct <- max(pushdat$push_count) / max(totl_dat$totl_count)
push_pct

# percent chance of loss
lossdat <- dat1 %>%
  filter(plwinamt == 0) %>%
  summarise(loss_count = n()) 

totl_dat <- dat1 %>%
  summarise(totl_count = n())

loss_pct <- max(lossdat$loss_count) / max(totl_dat$totl_count)
loss_pct

# pct of blackjack chance in win 
blkjckdat <- dat1 %>%
  filter(plwinamt == 25) %>%
  summarise(blkjck_count = n()) 

blkjck_true_pct <- max(blkjckdat$blkjck_count) / max(totl_dat$totl_count)
blkjck_true_pct

# calculate expected value
ex1 <- 15 * blkjck_true_pct
ex2 <- 10 * win_pct
ex3 <- -10 * loss_pct
ex4 <- 0 * push_pct

EV <- ex1 + ex2 +ex3 + ex
EV
```

```{r}
# first vis
# x needs to be play2cardsum/sumofcards and y is percentage of win/loss
x1 <- c(20, 25)
plhand_count <- dat1 %>%
  group_by(ply2cardsum) %>%
  summarise(count = n(), .groups = "keep")
glimpse(plhand_count)
  
plhand_win <- dat1 %>%
  group_by(ply2cardsum) %>%
  filter(plwinamt %in% x1) %>%
  summarise(win_count = n(), .groups = "keep")
glimpse(plhand_win)

plwin_pct <- plhand_count %>%
  left_join(plhand_win) %>%
  summarise(percent_win = win_count / count)

plot1 <- ggplot(plwin_pct, aes(ply2cardsum, percent_win)) +
  geom_bar(stat = "identity")
plot1

# facet by dealer card?

```



```{r}
dlhand_count <- dat1 %>%
  group_by(dealcard2) %>%
  summarise(count = n(), .groups = "keep")
glimpse(dlhand_count)
  
dlhand_win <- dat1 %>%
  group_by(dealcard2) %>%
  filter(dlwinamt %in% x2) %>%
  summarise(win_count = n(), .groups = "keep")
glimpse(dlhand_win)

dlwin_pct <- dlhand_count %>%
  left_join(dlhand_win) %>%
  summarise(percent_win = win_count / count)

plot2 <- ggplot(dlwin_pct, aes(dealcard2, percent_win)) +
  geom_bar(stat = "identity")
plot2


# second vis
# x is dealcard1 and y is winloss/dlbustbeat

ggplot(dat1, aes(dealcard1, ))

# third vis 
# ply2cardsum y is percent plybustbeat

# plot straight win push loss percentages 
```

```{r}

#Determine hit or stand based on ply2cardsum

#determine hit or stand based on dealcard1

# combine the two, show chart of all possibilities 
# ply2card sum (or possible hands) == rows and dealcard1 == col
```
